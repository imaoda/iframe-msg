!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).iframeMsg=n()}(this,function(){"use strict";function e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var n="",t={},r={},o=function(){console.warn("没有设置iframe的应答函数")},i="$$_$_id$_$$",a=6e4;function s(e){return e instanceof HTMLIFrameElement?e:"string"==typeof e?"#"===e[0]||"."===e[0]?document.querySelector(e):window.frames[e]:null}function f(){return Date.now()+""+(Math.round(1e5*Math.random())+1e5)}window.addEventListener("message",function(n){var a,s=n.data,f=n.source;try{a=JSON.stringify(s)}catch(e){}if(a&&a[i]){var c=a[i];if(t[c])t[c].resolve(s),delete t[c];else if(r[c])r[c].resolve(s),delete r[c];else{o(s,function(n){var t;f&&f.postMessage(JSON.stringify((e(t={},i,c),e(t,"data",n),t)),"*")})}}});var c=window.parent!==window;return{setDefaultSon:function(e){n=s(e)},setMsgHandler:function(e){o=e},sendSon:function(r,o){return new Promise(function(c,u){var d;if(n&&!n.isConnected&&(n=null),o||n){var l=s(o)||n;if(!l)return u("没有name为".concat(o,"的子iframe")),void console.warn("没有name为".concat(o,"的子iframe"));var m=f();l.contentWindow.postMessage(JSON.stringify((e(d={},i,m),e(d,"data",r),d)),"*"),t[m]={resolve:c,reject:u},setTimeout(function(){t[m]&&(t[m].reject("超时"),delete t[m])},a)}else u("没有设置发送子frame的name，也可通过默认值设置")})},sendDad:function(n){return new Promise(function(o,s){var u;c||(console.warn("本页面并非嵌入页，找不到对应父级"),s("本页面并非嵌入页，找不到对应父级"));var d=f();window.parent.postMessage(JSON.stringify((e(u={},i,d),e(u,"data",n),u)),"*"),r[d]={resolve:o,reject:s},setTimeout(function(){t[d]&&(t[d].reject("超时"),delete t[d])},a)})}}});
