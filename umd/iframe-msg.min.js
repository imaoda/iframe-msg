!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).iframeMsg=n()}(this,function(){"use strict";function e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var n="",t={},r={},i=function(){console.warn("没有设置iframe的应答函数")},o="$$_$_id$_$$",a=6e4;function f(e){if(e instanceof HTMLIFrameElement)return e;if("string"==typeof e){if("#"===e[0]||"."===e[0])return document.querySelector(e);if(window.frames[e])return e}return null}function s(){return Date.now()+""+(Math.round(1e5*Math.random())+1e5)}window.addEventListener("message",function(n){var a,f=n.data,s=n.source;try{a=JSON.parse(f)}catch(e){}if(a&&a[o]){var u=a[o];if(t[u])t[u].resolve(a.data),delete t[u];else if(r[u])r[u].resolve(a.data),delete r[u];else{i(a.data,function(n){var t;s&&s.postMessage(JSON.stringify((e(t={},o,u),e(t,"data",n),t)),"*")})}}});var u=window.parent!==window;return{setDefaultSon:function(e){n=f(e)},setMsgHandler:function(e){i=e},sendSon:function(r,i){return new Promise(function(u,d){var c;if(n&&(n instanceof HTMLIFrameElement&&!n.isConnected&&(n=null),"string"!=typeof n||window.frames[n]||(n=null)),i||n){var l=f(i);if(!i||l)if(i||(l="string"==typeof n?window.frames[n]:n.contentWindow),l){var m=s();l.postMessage(JSON.stringify((e(c={},o,m),e(c,"data",r),c)),"*"),t[m]={resolve:u,reject:d},setTimeout(function(){t[m]&&(t[m].reject("超时"),delete t[m])},a)}else d("没有找到对应的iframe");else d("没有名为".concat(i,"的子iframe"))}else d("没有设置发送子frame的name，也可通过默认值设置")})},sendDad:function(n){return new Promise(function(i,f){var d;u||(console.warn("本页面并非嵌入页，找不到对应父级"),f("本页面并非嵌入页，找不到对应父级"));var c=s();window.parent.postMessage(JSON.stringify((e(d={},o,c),e(d,"data",n),d)),"*"),r[c]={resolve:i,reject:f},setTimeout(function(){t[c]&&(t[c].reject("超时"),delete t[c])},a)})}}});
